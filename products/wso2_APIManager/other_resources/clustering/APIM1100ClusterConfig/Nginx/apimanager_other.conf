upstream keymgrhttp{
        sticky;

        server 192.168.48.42:9763;
        server 192.168.48.45:9763;
}
upstream keymgrhttps{
        sticky;

        server 192.168.48.42:9443;
        server 192.168.48.45:9443;
}
upstream storehttp{
        sticky;

        server 192.168.48.38:9763;
        server 192.168.48.39:9763;
}
upstream storehttps{
        sticky;

        server 192.168.48.38:9443;
        server 192.168.48.39:9443;
}
upstream publisherhttp{
#      ip_hash;
        sticky;

      server 192.168.48.37:9763;
}
upstream publisherhttps{
#      ip_hash;
        sticky;

      server 192.168.48.37:9443;
}


server {
      listen 443;
      server_name keymanager.am.wso2.com;

      location / {
              proxy_set_header X-Forwarded-Host $host;
              proxy_set_header X-Forwarded-Server $host;
              proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
              proxy_set_header Host $http_host;
              proxy_read_timeout 5m;
              proxy_send_timeout 5m;
              proxy_next_upstream error timeout invalid_header http_500;
              proxy_connect_timeout 2;
              proxy_pass https://keymgrhttps$request_uri;
        }

      ssl on;
      ssl_certificate /etc/nginx/ssl/keymanager.crt;
      ssl_certificate_key /etc/nginx/ssl/keymanager.key;
}
server {
      listen 80;
      server_name keymanager.am.wso2.com;

      location / {
              proxy_set_header X-Forwarded-Host $host;
              proxy_set_header X-Forwarded-Server $host;
              proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
              proxy_set_header Host $http_host;
              proxy_read_timeout 5m;
              proxy_send_timeout 5m;
              proxy_next_upstream error timeout invalid_header http_500;
              proxy_connect_timeout 2;
              proxy_pass http://keymgrhttp$request_uri;
        }

}
server {
      listen 443;
      server_name pub.am.wso2.com;

      location / {
              proxy_set_header X-Forwarded-Host $host;
              proxy_set_header X-Forwarded-Server $host;
              proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
              proxy_set_header Host $http_host;
              proxy_read_timeout 5m;
              proxy_send_timeout 5m;
              proxy_next_upstream error timeout invalid_header http_500;
              proxy_connect_timeout 2;
              proxy_pass https://publisherhttps$request_uri;
        }

      ssl on;
      ssl_certificate /etc/nginx/ssl/publisher.crt;
      ssl_certificate_key /etc/nginx/ssl/publisher.key;
}
server {
      listen 80;
      server_name pub.am.wso2.com;

      location / {
              proxy_set_header X-Forwarded-Host $host;
              proxy_set_header X-Forwarded-Server $host;
              proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
              proxy_set_header Host $http_host;
              proxy_read_timeout 5m;
              proxy_send_timeout 5m;
              proxy_next_upstream error timeout invalid_header http_500;
              proxy_connect_timeout 2;
              proxy_pass http://publisherhttp$request_uri;
        }

}
server {
      listen 443;
      server_name store.am.wso2.com;

      location / {
              proxy_set_header X-Forwarded-Host $host;
              proxy_set_header X-Forwarded-Server $host;
              proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
              proxy_set_header Host $http_host;
              proxy_read_timeout 5m;
              proxy_send_timeout 5m;
              proxy_next_upstream error timeout invalid_header http_500;
              proxy_connect_timeout 2;
              proxy_pass https://storehttps$request_uri;
        }

      ssl on;
      ssl_certificate /etc/nginx/ssl/apistore.crt;
      ssl_certificate_key /etc/nginx/ssl/apistore.key;
}
server {
      listen 80;
      server_name store.am.wso2.com;

      location / {
              proxy_set_header X-Forwarded-Host $host;
              proxy_set_header X-Forwarded-Server $host;
              proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
              proxy_set_header Host $http_host;
              proxy_read_timeout 5m;
              proxy_send_timeout 5m;
              proxy_next_upstream error timeout invalid_header http_500;
              proxy_connect_timeout 2;
              proxy_pass http://storehttp$request_uri;
        }

}